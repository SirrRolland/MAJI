<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Siswa</title>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            padding: 20px;
        }
        #studentList {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ccc;
            background: white;
        }
        .student {
            margin: 5px 0;
            display: flex;
            justify-content: space-between; /* Memisahkan nama dan tombol */
            align-items: center; /* Menjaga tombol di tengah */
        }
        button {
            margin-left: 10px; /* Jarak tombol dari nama */
            padding: 5px 10px;
            font-size: 14px;
        }
        #exitMessage {
            display: none;
            font-size: 24px;
            color: green;
        }
    </style>
</head>
<body>
    <h1>Absensi Siswa</h1>
    <div id="studentList">Daftar Siswa:</div>
    <button id="exitButton" onclick="exitApp()">Keluar</button>
    <audio id="backgroundMusic" loop>
        <source src="music/Himawari_No_Yakusoku(256k).mp3" type="audio/mpeg">
    </audio>
    <div id="exitMessage">Sampai Jumpa!</div>

    <script>
        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyDagk7NSN2KjYQ6JUHBTeMpYuIj2nMv-Co",
            authDomain: "students-70440.firebaseapp.com",
            databaseURL: "https://students-70440-default-rtdb.firebaseio.com/",
            projectId: "students-70440",
            storageBucket: "students-70440.appspot.com",
            messagingSenderId: "884830572053",
            appId: "1:884830572053:android:3f9708bde3d7df80b1881c"
        };

        // Inisialisasi Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Memulai musik saat aplikasi dimuat
        window.onload = function() {
            document.getElementById('backgroundMusic').play();
            loadStudents(); // Panggil fungsi untuk memuat daftar siswa
        };

        // Fungsi untuk memuat daftar siswa dari Firebase
        function loadStudents() {
            const studentListDiv = document.getElementById('studentList');
            database.ref('students').once('value').then((snapshot) => {
                console.log("Data siswa berhasil dimuat.");
                studentListDiv.innerHTML = "Daftar Siswa:"; // Kosongkan daftar siswa sebelum memuat
                snapshot.forEach((childSnapshot) => {
                    const student = childSnapshot.val();
                    const studentDiv = document.createElement('div');
                    studentDiv.className = "student"; // Tambahkan kelas untuk styling
                    studentDiv.innerText = student.name; // Ambil nama siswa dari data Firebase

                    // Buat tombol untuk menandai pulang
                    const markPresentButton = document.createElement('button');
                    markPresentButton.innerText = student.hasLeft ? "Sudah Pulang" : "Tandai Pulang"; // Periksa apakah sudah pulang
                    markPresentButton.disabled = student.hasLeft; // Nonaktifkan jika sudah pulang
                    markPresentButton.onclick = () => markPresent(student.id, markPresentButton);

                    studentDiv.appendChild(markPresentButton); // Tambahkan tombol ke div siswa
                    studentListDiv.appendChild(studentDiv);
                });
            }).catch((error) => {
                console.error("Error loading students:", error);
            });
        }

        // Fungsi untuk menandai siswa pulang
        function markPresent(studentId, button) {
            // Update status pulang di Firebase
            database.ref('students/' + studentId).update({
                hasLeft: true, // Tandai siswa sebagai sudah pulang
                leaveDate: new Date().toISOString() // Simpan tanggal pulang
            }).then(() => {
                alert(button.innerText + " sudah pulang! Boleh pulang lagi 2 Minggu setelah sekarang.");
                button.innerText = "Sudah Pulang"; // Ubah teks tombol
                button.disabled = true; // Nonaktifkan tombol setelah ditandai
            }).catch((error) => {
                console.error("Error updating student status:", error);
            });
        }

        // Fungsi untuk keluar dari aplikasi
        function exitApp() {
            document.getElementById('studentList').style.display = 'none';
            document.getElementById('exitButton').style.display = 'none';
            document.getElementById('exitMessage').style.display = 'block';
            document.getElementById('backgroundMusic').pause();
        }
    </script>
</body>
</html>
